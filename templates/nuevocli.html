
{% extends "menu.html" %}
{% load staticfiles %}
{% block content %}


    <form  method="post" id="formulario">


        {% csrf_token %}

        <table  border="0" align="center">

            <tr height="40px">
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>


                <td colspan="5" align="center" > <font color="black" face="Arial" size=4> <b> INGRESAR CLIENTE </b></font>  </td>


            </tr>
            <tr>

                <td colspan="5" height="10"><hr /></td>

            </tr>
            <tr>

                <td width="100" style="height: 30px ; vertical-align: middle"><label> <font color="black" face="Arial" size=3>Cedula: </font></label>  </td>
                <td width="100" style="height: 30px ; vertical-align: middle" align="center">
                    &nbsp; &nbsp; &nbsp;
                    <br><input type="text" name="txtCedula" style=" width: 200px ; height: 30px ;color: black" id="txtCedula" class="form-control" placeholder="Ingrese cedula"></td>
                <td width="20">&nbsp;</td>

                <td width="100" style="height: 30px" valign="middle"><label> <font color="black" face="Arial" size=3>Direccion: </font></label>  </td>

                <td width="100"> <br>

                    <input type="text" name="txtDir" style="width: 200px ; height: 30px ;color: black" id="txtDir" class="form-control" placeholder="Ingrese direccion"> </td>
            </tr>
            <tr>
                <td width="100" style="height: 30px ; vertical-align: middle"><label> <font color="black" face="Arial" size=3>Nombre: </font></label>  </td>
                <td width="100" style="height: 30px ; vertical-align: middle" align="center">
                    &nbsp; &nbsp; &nbsp;
                    <br><input type="text" name="txtNombre" style=" width: 200px ; height: 30px ;color: black" id="txtNombre" class="form-control" placeholder="Ingrese cedula"></td>
                <td width="100">&nbsp;</td>

                <td width="100" style="height: 30px" valign="middle"><label> <font color="black" face="Arial" size=3>Ciudad: </font></label>  </td>

                <td width="100"> <br>

                    <input type="text" name="txtCiu" style="width: 200px ; height: 30px ;color: black" id="txtCiu" class="form-control" placeholder="Ingrese direccion"> </td>
            </tr>
            <tr>


                <td style="height: 30px" valign="middle"><label> <font color="black" face="Arial" size=3>Apellido: </font></label>  </td>
                <td> <br>

                    <input type="text" name="txtApellido" style="width: 200px ; height: 30px ;color: black" id="txtApellido" class="form-control" placeholder="Ingrese apellido"> </td>
                <td height="10">&nbsp;</td>
                <td height="10">&nbsp;</td>
                <td height="10">&nbsp;</td>

            </tr>
            <tr>

                <td style="height: 30px" valign="middle"><label> <font color="black" face="Arial" size=3>Telefono: </font></label>  </td>

                <td> <br>

                    <input type="text" name="txtTel" style="width: 200px ; height: 30px ;color: black" id="txtTel" class="form-control" placeholder="Ingrese telefono"> </td>
                <td height="10">&nbsp;</td>
                <td height="10">&nbsp;</td>
                <td height="10">&nbsp;</td>
            </tr>




            <tr>

                <td colspan="5" height="10"><hr/></td>

            </tr>

            <tr>

                <td colspan="5" align="center" > <button type="submit" style="font-size: 15px; width: 190px"   class="btn btn-default" onclick="validarFormulario()" >
                    <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true" > </span>  <b> GUARDAR  </b>
                </button></td>


            </tr>
        </table>
    </form>

    <script>
        function validarFormulario(){

            document.getElementById("formulario").onsubmit=function(){




                var v1 = document.getElementById("txtNombre").value;
                var v2 = document.getElementById("txtApellido").value;
                var v3 = document.getElementById("txtTel").value;
                var v4 = document.getElementById("txtDir").value;
                var v5 = document.getElementById("txtCiu").value;
                if( v1 == null || v1.length == 0 || /^\s+$/.test(v1) || v2 == null || v2.length == 0 || /^\s+$/.test(v2) || v3 == null || v3.length == 0 || /^\s+$/.test(v3) || v4 == null || v4.length == 0 || /^\s+$/.test(v4)  || v5 == null || v5.length == 0 || /^\s+$/.test(v5) ) {
                    alert("Todos los campos son obligatorios");
                    return false;
                }


                var cedula =  document.getElementById("txtCedula").value;
                //Preguntamos si la cedula consta de 10 digitos
                if(cedula.length == 10){
                    if(cedula==2222222222){
                        alert("que pro");
                        return false
                    }
                    //Obtenemos el digito de la region que sonlos dos primeros digitos
                    var digito_region = cedula.substring(0,2);
                    //Pregunto si la region existe ecuador se divide en 24 regiones
                    if( digito_region >= 1 && digito_region <=24 ){
                        // Extraigo el ultimo digito
                        var ultimo_digito = cedula.substring(9,10);
                        //Agrupo todos los pares y los sumo
                        var pares = parseInt(cedula.substring(1,2)) + parseInt(cedula.substring(3,4)) + parseInt(cedula.substring(5,6)) + parseInt(cedula.substring(7,8));
                        //Agrupo los impares, los multiplico por un factor de 2, si la resultante es > que 9 le restamos el 9 a la resultante
                        var numero1 = cedula.substring(0,1);
                        var numero1 = (numero1 * 2);
                        if( numero1 > 9 ){ var numero1 = (numero1 - 9); }
                        var numero3 = cedula.substring(2,3);
                        var numero3 = (numero3 * 2);
                        if( numero3 > 9 ){ var numero3 = (numero3 - 9); }
                        var numero5 = cedula.substring(4,5);
                        var numero5 = (numero5 * 2);
                        if( numero5 > 9 ){ var numero5 = (numero5 - 9); }
                        var numero7 = cedula.substring(6,7);
                        var numero7 = (numero7 * 2);
                        if( numero7 > 9 ){ var numero7 = (numero7 - 9); }

                        var numero9 = cedula.substring(8,9);
                        var numero9 = (numero9 * 2);
                        if( numero9 > 9 ){ var numero9 = (numero9 - 9); }

                        var impares = numero1 + numero3 + numero5 + numero7 + numero9;

                        //Suma total
                        var suma_total = (pares + impares);

                        //extraemos el primero digito
                        var primer_digito_suma = String(suma_total).substring(0,1);

                        //Obtenemos la decena inmediata
                        var decena = (parseInt(primer_digito_suma) + 1) * 10;

                        //Obtenemos la resta de la decena inmediata - la suma_total esto nos da el digito validador
                        var digito_validador = decena - suma_total;

                        //Si el digito validador es = a 10 toma el valor de 0
                        if(digito_validador == 10)
                            var digito_validador = 0;

                        //Validamos que el digito validador sea igual al de la cedula
                        if(digito_validador == ultimo_digito){
                            var usu =document.getElementById('cedula').value;
                            usu=""+usu.slice(-9)
                            {% for a in paci %}
                                var ced=""+{{a.cedula}}
                                if(usu == ced) {
                                    alert("El numero de cedula ya existe")
                                    return false
                                }
                            {% endfor %}
                            return true
                        }else{
                            alert('la cedula:' + cedula + ' es incorrecta');
                            return false
                        }
                    }else{
                        // imprimimos en consola si la region no pertenece
                        alert('Esta cedula no pertenece a ninguna region');
                        return false
                    }
                }else{
                    //imprimimos en consola si la cedula tiene mas o menos de 10 digitos
                    alert('Esta cedula tiene menos de 10 Digitos');
                    return false
                }

            }
        }
        function borrarFormulario(){
            document.getElementById("formulario").onsubmit=function(){
                return true;
            }
        }
    </script>

{% endblock content %}